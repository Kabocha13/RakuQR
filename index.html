<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ラクア Ver8.4</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="apple-touch-icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRy-TqUoSIxdkbPuooctOiqi5gifXDO0oV1bQ&s"/>
  <link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRy-TqUoSIxdkbPuooctOiqi5gifXDO0oV1bQ&s">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
    }
    header {
      background-color: #333;
      color: white;
      display: flex;
      align-items: center;
      padding: 10px;
    }
    header img {
      height: 40px;
      margin-right: 10px;
      cursor: pointer;
    }
    header h1 {
      font-size: 1.2rem;
      margin: 0;
    }
    .menu-image-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4%;
      margin: 20px auto;
      max-width: 800px;
      padding: 0 10px;
    }
    .menu-image-row img {
      width: 48%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    .menu-image {
      text-align: center;
      margin-bottom: 30px;
    }
    .menu-image img {
      max-width: 100%;
      height: auto;
    }
    #go-today {
      display: block;
      width: 90%;
      max-width: 400px;
      margin: 20px auto;
      padding: 1rem;
      font-size: 1.5rem;
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 8px;
      text-align: center;
      transition: transform 0.2s ease, background-color 0.3s;
    }
    #go-today:active {
      transform: scale(0.96);
      background-color: #1976D2;
    }
    .button-row {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }

    .sub-button {
      padding: 0.8rem 1.2rem;
      font-size: 1rem;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      transition: background-color 0.3s ease;
    }

    .sub-button:active {
      background-color: #388E3C;
    }

    input[type="checkbox"] {
      display: none;
    }

    .actions-menu {
      position: fixed;
      width: 60px;
      height: 60px;
      right: 15px;
      bottom: 15px;
    }

    .actions-menu .btn {
      position: absolute;
      top: 8px;
      left: 8px;
      opacity: 0;
      transition: top 200ms cubic-bezier(0.175, 0.885, 0.32, 1.275),
                  left 200ms cubic-bezier(0.175, 0.885, 0.32, 1.275),
                  opacity 200ms;
    }

    .actions-menu .btn--menu {
      position: absolute;
      opacity: 1;
      top: 0;
      left: 0;
      z-index: 0;
    }

    .btn--menu, #actionMenuButton:checked + .actions-menu > .btn {
      opacity: 1;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }

    #actionMenuButton:checked + .actions-menu > .btn--menu:after {
      transform: rotate(45deg);
    }

    #actionMenuButton:checked + .actions-menu > .btn--menu:before {
      transform: rotate(-45deg);
    }

    #actionMenuButton:checked + .actions-menu > .btn--share {
      top: -70px;
    }

    #actionMenuButton:checked + .actions-menu > .btn--mail {
      top: -50px;
      left: -50px;
    }

    #actionMenuButton:checked + .actions-menu > .btn--question {
      left: -70px;
    }

    .btn {
      background: #e74c3c;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn--large {
      width: 60px;
      height: 60px;
      position: absolute;
      top: 0;
      left: 0;
    }

    .btn--menu:after, .btn--menu:before {
      content: "";
      display: block;
      width: 25px;
      height: 3px;
      background: #fff;
      position: absolute;
      top: 29px;
      left: 18px;
      transition: transform 100ms;
    }

    .btn--menu:after {
      transform: translateY(-5px);
    }

    .btn--menu:before {
      transform: translateY(5px);
    }

    .btn--share {
      background: #f39c12;
    }

    .btn--mail {
      background: #2ecc71;
    }

    .btn--question {
      background: #16a085;
    }
    .talk {
      color: red;
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRy-TqUoSIxdkbPuooctOiqi5gifXDO0oV1bQ&s"></a>
    <h1>RakuQR</h1>
  </header>
  <div class="talk">・一緒にディズニー行ってくれる人募集中！！</div>
  <button id="go-today">出席する</button>
  <div class="button-row">
    <button class="sub-button" onclick="location.href='https://cit.manaba.jp/ct/home/'">manaba</button>
    <button class="sub-button" onclick="location.href='https://portal.it-chiba.ac.jp/uprx/up/pk/pky001/Pky00101.xhtml/'">CITportal</button>
  </div>

  <div id="menu-banners" class="menu-image-row"></div>

  <h1>今週の食堂メニュー</h1>
  <div id="menu1" class="menu-image"></div>
  <div id="menu2" class="menu-image"></div>
  <h>このサービスを利用したことによる利害について製作者は一切の責任をもちません。</h>
  <input type="checkbox" id="actionMenuButton"/>

  <div class="actions-menu">
    <button class="btn btn--share" onclick="window.open('https://twitter.com/intent/tweet?url=https%3A%2F%2Fkabocha13.github.io%2FRakuQR%2F&text=24年入学知能メディア工学科専用出席アプリ&via=kabocha13_cit', '_blank')">
      <span class="material-icons" style="color:white;">share</span>
    </button>    
    <button class="btn btn--mail" onclick="window.open('https://kabocha13.github.io/RakuQR/tell.html', '_blank')">
      <span class="material-icons" style="color:white;">mail</span>
    </button>
    <button class="btn btn--question" onclick="window.open('https://kabocha13.github.io/RakuQR/question.html', '_blank')">
      <span class="material-icons" style="color:white;">question_mark</span>
    </button>
    <label for="actionMenuButton" class="btn btn--large btn--menu"></label>
  </div>

  <script>
    function getMenuURL(baseName) {
      const today = new Date();
      const day = today.getDay();
      const sunday = new Date(today);
      sunday.setDate(today.getDate() - day);
      const weekdays = [];
      for (let i = 1; i <= 5; i++) {
        const d = new Date(sunday);
        d.setDate(sunday.getDate() + i);
        weekdays.push(d);
      }
      const monthCounts = {};
      for (const d of weekdays) {
        const yyyymm = `${d.getFullYear()}${String(d.getMonth() + 1).padStart(2, '0')}`;
        monthCounts[yyyymm] = (monthCounts[yyyymm] || 0) + 1;
      }
      const sortedMonths = Object.keys(monthCounts).sort((a, b) => {
        if (monthCounts[a] === monthCounts[b]) return b.localeCompare(a);
        return monthCounts[b] - monthCounts[a];
      });
      const targetMonth = sortedMonths[0];
      const startDate = new Date(Number(targetMonth.slice(0, 4)), Number(targetMonth.slice(4)) - 1, 1);
      startDate.setDate(startDate.getDate() - startDate.getDay());
      let weekNumber = 0;
      const now = new Date();
      while (startDate <= now) {
        let hasWeekdayInTargetMonth = false;
        for (let i = 1; i <= 5; i++) {
          const d = new Date(startDate);
          d.setDate(startDate.getDate() + i);
          const yyyymm = `${d.getFullYear()}${String(d.getMonth() + 1).padStart(2, '0')}`;
          if (yyyymm === targetMonth) {
            hasWeekdayInTargetMonth = true;
            break;
          }
        }
        if (hasWeekdayInTargetMonth) {
          weekNumber++;
        }
        startDate.setDate(startDate.getDate() + 7);
      }
      return `https://www.cit-s.com/wp/wp-content/themes/cit/menu/${baseName}_${targetMonth}_${weekNumber}.png`;
    }

    const menu1 = document.createElement("img");
    menu1.src = getMenuURL("sd1");
    menu1.alt = "食堂メニュー1";
    document.getElementById("menu1").appendChild(menu1);

    const menu2 = document.createElement("img");
    menu2.src = getMenuURL("sd2");
    menu2.alt = "食堂メニュー2";
    document.getElementById("menu2").appendChild(menu2);

    document.getElementById("go-today").addEventListener("click", () => {
      const days = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];
      const today = new Date().getDay();
      location.href = `${days[today]}.html`;
    });

    // 画像バナーを平日11:00〜14:00のみ表示
    (function insertBanners() {
      const now = new Date();
      const day = now.getDay();
      const hour = now.getHours();
      if (day >= 1 && day <= 5 && hour >= 11 && hour < 14) {
        const timestamp = now.getFullYear().toString()
          + String(now.getMonth() + 1).padStart(2, '0')
          + String(now.getDate()).padStart(2, '0')
          + String(now.getHours()).padStart(2, '0')
          + String(now.getMinutes()).padStart(2, '0')
          + String(now.getSeconds()).padStart(2, '0');
        const urls = [
          `https://www.cit-s.com/i_catch/dining/narashino1_dummy.jpg?${timestamp}`,
          `https://www.cit-s.com/i_catch/dining/narashino2_dummy.jpg?${timestamp}`
        ];
        const bannerDiv = document.getElementById("menu-banners");
        urls.forEach(url => {
          const img = document.createElement("img");
          img.src = url;
          img.alt = "食堂バナー";
          bannerDiv.appendChild(img);
        });
      }
    })();
  </script>
</body>
</html>
